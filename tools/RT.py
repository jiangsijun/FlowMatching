import cv2
import numpy as np
# points = np.array([
#     [0.227, 0.229, 1.0700001, 642, 108],
#     [0.212, -0.044, 1.027, 642, 548],
#     [-0.047, 0.222, 1.097, 1070, 109],
#     [-0.048, -0.038, 1.057, 1070, 550],
#     #2
#     [0.20299999, 0.24699999, 1.1619999, 528, 112],
#     [0.19599999, -0.019, 1.1390001, 527, 536],
#     [-0.085, 0.23999999, 1.184, 941, 116],
#     [-0.081, -0.03, 1.155, 942, 536],
#     #3
#     [0.324, 0.244, 1.149, 527, 110],
#     [0.30000001, -0.035, 1.092, 529, 534],
#     [0.039, 0.243, 1.1900001, 941, 114],
#     [0.038, -0.032, 1.141, 945, 536],
#     #4
#     [0.18700001, 0.257, 1.2309999, 750, 123],
#     [0.17, -0.03, 1.184, 752, 525],
#     [-0.098, 0.248, 1.243, 1138, 124],
#     [-0.105, -0.026, 1.2180001, 1138, 524],
#     #5
#     [0.103, 0.25400001, 1.232, 862, 124],
#     [0.088, -0.028, 1.1950001, 861, 524],
#     [-0.18700001, 0.25400001, 1.255, 1250, 120],
#     [-0.17900001, -0.022, 1.23, 1248, 523],
#     #6
#     [0.099, 0.25400001, 1.2309999, 860, 123],
#     [0.088, -0.028, 1.1950001, 861, 525],
#     [-0.18700001, 0.25400001, 1.255, 1249, 120],
#     [-0.185, -0.02, 1.243, 1250, 525],
#     #7
#     [0.097, 0.226, 1.102, 844, 115],
#     [0.09, -0.044, 1.052, 846, 553],
#     [-0.18000001, 0.223, 1.119, 1270, 111],
#     [-0.17900001, -0.036, 1.091, 1268, 554],
#     #8
#     [0.233, 0.228, 1.1, 635, 110],
#     [0.219, -0.041, 1.0470001, 636, 550],
#     [-0.043, 0.226, 1.122, 1063, 110],
#     [-0.04, -0.038, 1.071, 1063, 552],
#     # 继续添加更多的特征点
# ])

# 相机到点云的标定

points_cloud = np.array([[ 0.16,-0.085,1.27],
                         [0.064,0.18799999,1.418 ],
                         [-0.228,-0.42899999,3.0650001],
                          [-0.41,-0.081,1.302],

                        [-0.31200001,0.082,1.349],
                         [-0.41800001,0.17299999,1.418],
                         [-0.22400001,-0.56999999,3.0840001],
                          ], dtype=np.float32)

# 2D图像中对应的三个点的坐标（相机坐标系）
points_pixel = np.array([[789, 592],
                         [941, 267],
                         [1138, 721],
                         [1532, 588],

                        [1398, 380],
                         [1504, 286],
                         [1144, 788]], dtype=np.float32)

# 相机内参矩阵
camera_matrix = np.array([[1686.4112483378, 0, 1048.37299068491],
                          [0, 1681.77170179537, 498.541473285944],
                          [0, 0, 1]], dtype=np.float32)

distCoeffs = np.array([0.0754663,-0.4918826,0,0,0],dtype=np.float32)
# 求解外参矩阵（忽略畸变）
retval, rvec, tvec= cv2.solvePnP(points_cloud, points_pixel, camera_matrix, distCoeffs)

# 将旋转向量转换为旋转矩阵
R, _ = cv2.Rodrigues(rvec)

# 输出结果
print("旋转矩阵 R:")
print(R)
print("\n平移向量 T:")
print(tvec)